@using SiFoodProjectFormal2._0.Areas.Users.Models.ViewModels;
@model IEnumerable<StoreVM>
@{
    Layout = "~/Areas/Users/Views/Shared/_Layout.cshtml";
}

@section Styles{
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.css">
}
@{
    ViewData["Title"] = "HomePage";
}
<div>



    <div class="container" id="main">
        <section>

            <div class="slider slider-nav responsive row  mx-auto p-3 " style="display:flex;justify-content: space-around">

                <div class="d-flex justify-content-center">
                    <img class="rounded-2" style="width:360px ;height:180px" src="~/assets/images/banner/ad-banner-1.jpg" alt="">
                </div>

                <div class="d-flex justify-content-center">
                    <img class="rounded-2" style="width:360px ;height:180px" src="~/assets/images/banner/ad-banner-2.jpg" alt="">
                </div>
                <div class="d-flex justify-content-center">
                    <img class="rounded-2" style="width:360px ;height:180px" src="~/assets/images/banner/ad-banner-3.jpg" alt="">
                </div>
                <div class="d-flex justify-content-center">
                    <img class="rounded-2" style="width:340px ;height:180px" src="~/assets/images/banner/ad-banner-4.jpg" alt="">
                </div>
                <div class="d-flex justify-content-center">
                    <img class="rounded-2" style="width:340px ;height:180px" src="~/assets/images/banner/ad-banner-5.jpg" alt="">
                </div>
            </div>

        </section>
        <!-- row -->
        <div class="row gx-10">
            <!-- col -->
            <aside class="col-lg-3 col-md-4 mb-6 mb-md-0">
                <div class="offcanvas offcanvas-start offcanvas-collapse w-md-50 " tabindex="-1" id="offcanvasCategory" aria-labelledby="offcanvasCategoryLabel">

                    <div class="offcanvas-header d-lg-none">
                        <h5 class="offcanvas-title" id="offcanvasCategoryLabel">Filter</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body ps-lg-2 pt-lg-0">
                        <div class="mb-8">
                            <!-- title -->
                            <h5 class="mb-3">依地區探索</h5>
                            <!-- nav -->
                            <ul class="nav nav-category" id="categoryCollapseMenu">
                                <li class="nav-item border-bottom w-100 ">
                                    <a v-on:click="filterArea" class="nav-link collapsed" style="color:#6c757d;font-weight: bold" data-bs-toggle="collapse" data-bs-target="#categoryFlushOne" aria-expanded="false" aria-controls="categoryFlushOne">臺北市<i class="feather-icon icon-chevron-right"></i></a>
                                    <!-- accordion collapse -->
                                    <div id="categoryFlushOne" class="accordion-collapse collapse" data-bs-parent="#categoryCollapseMenu">
                                        <div>
                                            <!-- nav -->

                                            <ul class="nav flex-column ms-3">
                                                <!-- nav item -->
                                                <li class="nav-item"><a href="#!" class="nav-link">Milk</a></li>

                                            </ul>



                                        </div>
                                    </div>

                                </li>
                                <!-- nav item -->
                                <li class="nav-item border-bottom w-100 ">
                                    <a v-on:click="filterArea" class="nav-link collapsed" style="color:#6c757d;font-weight: bold" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                                        新北市 <i class="feather-icon icon-chevron-right"></i>
                                    </a>

                                    <!-- collapse -->
                                    <div id="flush-collapseTwo" class="accordion-collapse collapse" data-bs-parent="#categoryCollapseMenu">
                                        <div>
                                            <ul class="nav flex-column ms-3">
                                                <!-- nav item -->
                                                <li class="nav-item"><a href="#!" class="nav-link">Chips &amp; Crisps</a></li>
                                            </ul>
                                        </div>
                                    </div>

                                </li>


                            </ul>
                        </div>
                        <div class="mb-8">
                            <!-- title -->
                            <h5 class="mb-3">依種類探索</h5>
                            <!-- nav -->
                            <ul class="nav nav-category ">
                                <li class="nav-item border-bottom w-100 ">
                                    <a  v-model="isCategory" class="nav-link " style="color:#6c757d;font-weight: bold">生鮮</a>
                                </li>
                                <li class="nav-item border-bottom w-100 ">
                                    <a  v-model="isCategory" class="nav-link " style="color:#6c757d;font-weight: bold">飲料</a>
                                </li>
                                <li class="nav-item border-bottom w-100 ">
                                    <a  v-model="isCategory" class="nav-link" style="color:#6c757d;font-weight: bold">甜點麵包</a>
                                </li>
                                <li class="nav-item border-bottom w-100 ">
                                    <a  v-model="isCategory" class="nav-link" style="color:#6c757d;font-weight: bold">便當</a>

                                </li>
                                <li class="nav-item border-bottom w-100 ">
                                    <a  v-model="isCategory" class="nav-link" style="color:#6c757d;font-weight: bold">素食</a>
                                </li>
                                <li class="nav-item border-bottom w-100 ">
                                    <a  v-model="isCategory" class="nav-link " style="color:#6c757d;font-weight: bold">異國料理</a>
                                </li>
                                <li class="nav-item border-bottom w-100 ">
                                    <a  v-model="isCategory" class="nav-link " style="color:#6c757d;font-weight: bold">其他</a>
                                </li>

                            </ul>
                        </div>
                        <div class="mb-8">

                            <h5 class="mb-3">店家狀態</h5>

                            <!-- form check -->
                            <div class="form-check mb-2">
                                <!-- input -->
                                <input class="form-check-input" style="color:#6c757d;border: 2px solid" type="checkbox" id="isOpen" value="false" v-model="isStoreActive">
                                <label class="form-check-label" style="color:#6c757d;font-weight: bold" for="isOpen">
                                    營業中
                                </label>
                            </div>
                            <!-- form check -->
                            <div class="form-check mb-2">
                                <!-- input -->
                                <input class="form-check-input" style="color:#6c757d;border: 2px solid" type="checkbox" value="" id="Dmart">
                                <label class="form-check-label" style="color:#6c757d;font-weight: bold" for="Dmart">
                                    尚有剩食庫存
                                </label>
                            </div>



                        </div>

                        <div class="mb-8 position-relative">
                            <h5 class="mb-3">探索你的周遭</h5>
                            <!-- Banner Design -->
                            <!-- Banner Content -->
                            <div class="position-absolute p-5 py-8">


                                <a href="#" class="btn btn-dark">GO<i class="feather-icon icon-arrow-right ms-1"></i></a>
                            </div>
                            <!-- Banner Content -->
                            <!-- Banner Image -->
                            <!-- img --><img src="~/images/mapsmall.jpg" class="img-fluid rounded " />
                            <!-- Banner Image -->
                        </div>
                    </div>
                </div>
            </aside>
            <section class="col-lg-9 col-md-12">


                <!-- list icon -->
                <div class="d-lg-flex justify-content-between align-items-center">
                    <div class="mb-3 mb-lg-0">
                        <p class="mb-0"> <span class="text-dark">{{storeCount}}</span> Stores found </p>
                    </div>

                </div>

                <!-- row -->
                <div class="row g-4 row-cols-xl-3 row-cols-lg-3 row-cols-2 row-cols-md-2 mt-2">
                    <!--店家showstart-->
                    <!-- col -->
                    <div class="col" v-for="(item,index) in showStores" :key="index">
                        <!-- card -->
                        <div class="card h-100 card-product">

                            <div class="card-body">

                                <!-- badge -->
                                <div class="text-center position-relative ">
                                    <div class=" position-absolute top-0 start-0">
                                        <span class="badge bg-danger">庫存:{{item.inventory}}</span>
                                    </div>
                                    <a href="shop-single.html">
                                        <!-- img --><img :src="item.logoPath" class="mb-3 img-fluid" />
                                    </a>

                                </div>
                                <!-- heading -->
                                <div class=" mb-1">
                                    <a href="#!" class="text-decoration-none text-muted">
                                        <h5>
                                            {{item.storeName}}
                                        </h5>
                                    </a>
                                </div>

                                <div>

                                    <h6 class="text-inherit text-muted ">{{item.description}}</h6>
                                </div>
                                <!-- price -->
                                <div class="d-flex justify-content-between align-items-center mt-3">
                                    <div>

                                        <small class="text-warning">
                                            <i class="bi bi-star-fill"></i>

                                        </small> <span class="text-muted">{{item.commentRank}} ({{item.commentCount}})</span>

                                    </div>
                                    <!-- btn -->
                                    <div>
                                        <a href="#!" class="btn btn-primary btn-sm">
                                            <i class="bi bi-heart"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <!--店家showend-->
                </div>



                <!-- row -->
                <div class="row mt-8">
                    <div class="col">
                        <!-- nav -->
                        <nav>
                            <ul class="pagination">
                                <li class="page-item disabled">
                                    <a class="page-link  mx-1 " href="#" aria-label="Previous">
                                        <i class="feather-icon icon-chevron-left"></i>
                                    </a>
                                </li>
                                <li class="page-item "><a class="page-link  mx-1 active" href="#">1</a></li>
                                <li class="page-item"><a class="page-link mx-1 text-body" href="#">2</a></li>
                                <li class="page-item"><a class="page-link mx-1 text-body" href="#">...</a></li>
                                <li class="page-item"><a class="page-link mx-1 text-body" href="#">12</a></li>
                                <li class="page-item">
                                    <a class="page-link mx-1 text-body" href="#" aria-label="Next">
                                        <i class="feather-icon icon-chevron-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </section>
        </div>
    </div>

</div>
@section Scripts{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.js"></script>
    <script src="https://unpkg.com/vue@3.2.36/dist/vue.global.js"></script>
    <script>
        var baseAddress = "https://localhost:7042";

        const storeApp = Vue.createApp({
            data: function () {
                return {
                    isStoreActive: false,
                    stores: [],
                    storeCount: "",
                    catestores:[],
                    isCategory: null,
                 

                }
            },
            computed: {
                showStores: function () {
                    var x = this.filterActiveTime(this.stores);
                    // var r = this.filterArea(x);

                   var c = this.filtercategory(x);
                    return c;
                    alert(c);
                },
                // filterStores: function () {
                //     return _this.stores.filter(s => s.categoryName.indexOf(this.search) !== -1);
                // },

            },
            mounted: function () {
                let _this = this;
                _this.getStoreapi();

            },
            methods: {
                filterActiveTime(stores) {
                    if (this.isStoreActive) {
                        return stores.filter(s => s.commentRank >=5);
                    }
                    return stores;
                },
                filterArea(stores) {
                    // let area[,]=
                    return stores;
                },
                filtercategory(stores){
                    let _this = this;
                    
                    if (this.isCategory == '便當') { alert(JSON.stringify(_this.stores.filter(s => s.categoryName.indexOf("便當") !== -1))); }
                    if (this.isCategory == '生鮮') { return _this.stores.filter(s => s.categoryName.indexOf("生鮮") !== -1); _this.storeCount = _this.stores.length; }
                    if (this.isCategory == '飲料') { return _this.stores.filter(s => s.categoryName.indexOf("飲料") !== -1); _this.storeCount = _this.stores.length; alert(_this.catestores); }
                    if (this.isCategory == '甜點麵包') { return _this.stores.filter(s => s.categoryName.indexOf("甜點麵包") !== -1); _this.storeCount = _this.stores.length; }
                    // if (isCategory == '便當') { return _this.stores.filter(s => s.categoryName.indexOf("便當") !== -1); _this.storeCount = _this.stores.length; alert(_this.catestores); }
                    if (this.isCategory == '素食') { return _this.stores.filter(s => s.categoryName.indexOf("素食") !== -1); _this.storeCount = _this.stores.length; }
                    if (this.isCategory == '異國料理') { return _this.stores.filter(s => s.categoryName.indexOf("異國料理") !== -1); _this.storeCount = _this.stores.length; }
                    if (this.isCategory == '其他') { return _this.stores.filter(s => s.categoryName.indexOf("其他") !== -1); _this.storeCount = _this.stores.length; }
                    else { return _this.stores; }
                },

                getStoreapi() {
                    let _this = this;
                    fetch(`${baseAddress}/odata/Storeapi/Main2`, { method: "GET" })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP error! Status: ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(data => {
                            // alert(JSON.stringify(data));
                            
                            _this.stores = data;
                            _this.storeCount = _this.stores.length;
                        }).catch(error => {
                            alert(error);
                        });

                },




            }
        }).mount("#main");

    </script>
    <script src="~/slickcdn.min.js"></script>
    <script>
        var baseAddress = "https://localhost:7042";

        $('.slider-nav').slick({
            infiinte: true,
            slidesToShow: 3,
            slidesToScroll: 1,
            autoplaySpeed: 3000,
            dots: true,
            arrows: false,
            focusOnSelect: true,
            autoplay: true,
            responsive: [
                {
                    breakpoint: 1024,
                    settings: {
                        slidesToShow: 3,
                        slidesToScroll: 3,
                        infinite: true,
                        dots: true
                    }
                },
                {
                    breakpoint: 600,
                    settings: {
                        slidesToShow: 2,
                        slidesToScroll: 2
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: 1
                    }
                }
            ]
        });


    </script>



}
